<UserControl x:Class="DevTools.Presentation.Wpf.Components.RunSummaryControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="400">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        
        <Style x:Key="ResultCardStyle" TargetType="Border">
            <Setter Property="Background" Value="#252526"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="Margin" Value="0,10,0,0"/>
            <Setter Property="BorderBrush" Value="#3F3F46"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <Style x:Key="StatLabelStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#AAAAAA"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Margin" Value="0,0,10,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style x:Key="StatValueStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FFFFFF"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Border Style="{StaticResource ResultCardStyle}" Visibility="{Binding HasResult, Converter={StaticResource BoolToVis}, FallbackValue=Collapsed}">
            <StackPanel>
                <!-- Status Header -->
                <Grid Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Orientation="Horizontal" Grid.Column="0">
                        <TextBlock Text="{Binding StatusIcon}" FontSize="18" Margin="0,0,10,0" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding StatusText}" FontSize="16" FontWeight="Bold" Foreground="{Binding StatusColor}" VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <TextBlock Grid.Column="2" Text="{Binding Duration}" Foreground="#888888" VerticalAlignment="Center"/>
                </Grid>

                <Separator Background="#3F3F46" Margin="0,0,0,15"/>

                <!-- Key Stats Grid -->
                <UniformGrid Columns="2" Rows="2" Margin="0,0,0,15">
                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Processados" Style="{StaticResource StatLabelStyle}"/>
                        <TextBlock Text="{Binding ProcessedCount}" Style="{StaticResource StatValueStyle}"/>
                    </StackPanel>
                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Alterados" Style="{StaticResource StatLabelStyle}"/>
                        <TextBlock Text="{Binding ChangedCount}" Style="{StaticResource StatValueStyle}"/>
                    </StackPanel>
                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Ignorados" Style="{StaticResource StatLabelStyle}"/>
                        <TextBlock Text="{Binding IgnoredCount}" Style="{StaticResource StatValueStyle}"/>
                    </StackPanel>
                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Falhas" Style="{StaticResource StatLabelStyle}"/>
                        <TextBlock Text="{Binding FailedCount}" Style="{StaticResource StatValueStyle}" Foreground="{Binding FailedColor}"/>
                    </StackPanel>
                </UniformGrid>

                <!-- Details Expander -->
                <Expander Header="Detalhes e Erros" IsExpanded="False" Foreground="#CCCCCC" BorderBrush="#3F3F46" Background="Transparent" Visibility="{Binding HasErrors, Converter={StaticResource BoolToVis}}">
                    <ItemsControl ItemsSource="{Binding Errors}" Margin="0,10,0,0">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#1E1E1E" Padding="10" Margin="0,0,0,5" CornerRadius="2" BorderBrush="#3F3F46" BorderThickness="1">
                                    <StackPanel>
                                        <TextBlock Text="{Binding Message}" Foreground="#FF6B6B" FontWeight="Bold" TextWrapping="Wrap"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,5,0,0" Visibility="{Binding Cause, Converter={StaticResource BoolToVis}}">
                                            <TextBlock Text="Causa: " Foreground="#888888"/>
                                            <TextBlock Text="{Binding Cause}" Foreground="#CCCCCC"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,2,0,0" Visibility="{Binding Action, Converter={StaticResource BoolToVis}}">
                                            <TextBlock Text="Sugestão: " Foreground="#4EC9B0"/>
                                            <TextBlock Text="{Binding Action}" Foreground="#CCCCCC"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Expander>
                
                <!-- Output Location Link -->
                 <TextBlock Margin="0,10,0,0" Visibility="{Binding OutputLocation, Converter={StaticResource BoolToVis}}">
                    <Run Text="Saída em: " Foreground="#888888"/>
                    <Run Text="{Binding OutputLocation}" Foreground="#569CD6" TextDecorations="Underline" Cursor="Hand"/> <!-- Click handler logic would be in code behind -->
                </TextBlock>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
