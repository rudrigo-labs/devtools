<UserControl x:Class="DevTools.Presentation.Wpf.Views.SettingsTabView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:components="clr-namespace:DevTools.Presentation.Wpf.Components"
             mc:Ignorable="d">

    <Grid>
        <StackPanel x:Name="SettingsListPanel" VerticalAlignment="Top" HorizontalAlignment="Stretch" Margin="0,10">
            <TextBlock Text="Configurações do Projeto" FontSize="24" FontWeight="Light" Foreground="White" Margin="0,0,0,20"/>
            <WrapPanel Orientation="Horizontal" Margin="0,0,-15,0">
                <Button Style="{StaticResource ToolCardStyle}" Tag="&#xE753;" Content="Túnel SSH" 
                        ToolTip="Gerenciar perfis e chaves SSH" Width="200" Click="OpenSshSettings_Click"/>

                <Button Style="{StaticResource ToolCardStyle}" Tag="&#xE896;" Content="Harvest" 
                        ToolTip="Configurar regras de extração e IA" Width="200" Click="OpenHarvestSettings_Click"/>

                <Button Style="{StaticResource ToolCardStyle}" Tag="&#xE8B7;" Content="Organizer" 
                        ToolTip="Categorias e regras de organização" Width="200" Click="OpenOrganizerSettings_Click"/>

                <Button Style="{StaticResource ToolCardStyle}" Tag="&#xE7F8;" Content="Migrations" 
                        ToolTip="Caminhos e contextos do EF Core" Width="200" Click="OpenMigrationsSettings_Click"/>

                <Button Style="{StaticResource ToolCardStyle}" Tag="&#xE91B;" Content="Ngrok" 
                        ToolTip="Caminho do executável e token" Width="200" Click="OpenNgrokSettings_Click"/>
            </WrapPanel>
        </StackPanel>

        <Grid x:Name="SshSettingsPanel" Visibility="Collapsed">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                <Button Content="&#xE72B;" FontFamily="Segoe MDL2 Assets" FontSize="16" 
                        Foreground="White" Background="Transparent" BorderThickness="0"
                        Click="BackToSettingsList_Click" Margin="0,0,10,0"/>
                <TextBlock Text="Configuração: Túnel SSH" FontSize="20" FontWeight="SemiBold" Foreground="White" VerticalAlignment="Center"/>
            </StackPanel>

            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="250"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Border BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,1,0" Padding="0,0,10,0">
                    <DockPanel>
                        <Button DockPanel.Dock="Bottom" Content="+ Novo Perfil" Style="{StaticResource SecondaryButtonStyle}" 
                                Height="35" Margin="0,10,0,0" Click="AddSshProfile_Click"/>
                        <ListBox x:Name="SshProfilesList" Background="Transparent" BorderThickness="0" 
                                 Foreground="White" DisplayMemberPath="Name" SelectionChanged="SshProfile_SelectionChanged">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Padding" Value="10,8"/>
                                    <Setter Property="Margin" Value="0,0,0,2"/>
                                    <Setter Property="Background" Value="#2D2D30"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ListBoxItem">
                                                <Border Background="{TemplateBinding Background}" CornerRadius="4" Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter/>
                                                </Border>
                                                    <ControlTemplate.Triggers>
                                                    <Trigger Property="IsSelected" Value="True">
                                                        <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
                                                    </Trigger>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Cursor" Value="Hand"/>
                                                        <Setter Property="Background" Value="#3E3E42"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ListBox.ItemContainerStyle>
                        </ListBox>
                    </DockPanel>
                </Border>

                <ScrollViewer Grid.Column="1" Margin="20,0,0,0" VerticalScrollBarVisibility="Auto" Padding="0,0,10,0">
                    <StackPanel x:Name="SshEditForm" Visibility="Collapsed">
                        <TextBlock Text="Dados de Conexão (SSH)" FontSize="16" Foreground="{StaticResource AccentBrush}" Margin="0,0,0,10"/>

                        <Label Content="Nome do Perfil" Foreground="#CCCCCC"/>
                        <TextBox x:Name="SshProfileName" Style="{StaticResource InputStyle}"/>

                        <Grid Margin="0,10,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="3*"/>
                                <ColumnDefinition Width="1*"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Margin="0,0,10,0">
                                <Label Content="Host SSH (Servidor)" Foreground="#CCCCCC"/>
                                <TextBox x:Name="SshHost" Style="{StaticResource InputStyle}"/>
                            </StackPanel>
                            <StackPanel Grid.Column="1">
                                <Label Content="Porta" Foreground="#CCCCCC"/>
                                <TextBox x:Name="SshPort" Style="{StaticResource InputStyle}"/>
                            </StackPanel>
                        </Grid>

                        <Label Content="Usuário SSH" Foreground="#CCCCCC" Margin="0,10,0,0"/>
                        <TextBox x:Name="SshUser" Style="{StaticResource InputStyle}"/>

                        <Label Content="Caminho da Chave Privada (Private Key) - .pem/.ppk" Foreground="#CCCCCC" Margin="0,10,0,0"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="SshKeyFile" Style="{StaticResource InputStyle}"/>
                            <Button Grid.Column="1" Content="..." Width="30" Height="30" Margin="5,0,0,0" Style="{StaticResource SecondaryButtonStyle}" Click="BrowseSshKey_Click"/>
                        </Grid>

                        <TextBlock Text="Mapeamento do Túnel" FontSize="16" Foreground="{StaticResource AccentBrush}" Margin="0,20,0,10"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel>
                                <Label Content="Bind Local (IP)" Foreground="#CCCCCC"/>
                                <TextBox x:Name="LocalBind" Style="{StaticResource InputStyle}"/>
                            </StackPanel>
                            <StackPanel Grid.Column="1" Margin="5,0,0,0">
                                <Label Content="Porta Local" Foreground="#CCCCCC"/>
                                <TextBox x:Name="LocalPort" Style="{StaticResource InputStyle}" Width="80"/>
                            </StackPanel>

                            <TextBlock Grid.Column="2" Text="→" VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="#666" FontSize="16" Margin="0,20,0,0"/>

                            <StackPanel Grid.Column="3">
                                <Label Content="Host Remoto (Destino)" Foreground="#CCCCCC"/>
                                <TextBox x:Name="RemoteHost" Style="{StaticResource InputStyle}"/>
                            </StackPanel>
                            <StackPanel Grid.Column="4" Margin="5,0,0,0">
                                <Label Content="Porta Remota" Foreground="#CCCCCC"/>
                                <TextBox x:Name="RemotePort" Style="{StaticResource InputStyle}" Width="80"/>
                            </StackPanel>
                        </Grid>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
                            <Button Content="Remover Perfil" Click="DeleteSshProfile_Click" Background="Transparent" Foreground="#E81123" BorderThickness="0" Margin="0,0,10,0"/>
                            <Button Content="Salvar Alterações" Click="SaveSshProfile_Click" Style="{StaticResource PrimaryButtonStyle}" Width="150"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Grid>

        <Grid x:Name="HarvestSettingsPanel" Visibility="Collapsed">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                <Button Content="&#xE72B;" FontFamily="Segoe MDL2 Assets" FontSize="16" 
                        Foreground="White" Background="Transparent" BorderThickness="0"
                        Click="BackToSettingsList_Click" Margin="0,0,10,0"/>
                <TextBlock Text="Configuração: Harvest" FontSize="20" FontWeight="SemiBold" Foreground="White" VerticalAlignment="Center"/>
            </StackPanel>

            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="0,0,20,0">
                    <TextBlock Text="Regras de Filtragem" FontSize="16" Foreground="{StaticResource AccentColor}" Margin="0,0,0,10"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel>
                            <Label Content="Extensões Permitidas (separadas por vírgula)" Foreground="#CCCCCC"/>
                            <TextBox x:Name="HarvestExtensions" Style="{StaticResource ModernTextBoxStyle}" 
                                     Height="100" AcceptsReturn="True" TextWrapping="Wrap" VerticalContentAlignment="Top"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2">
                            <Label Content="Pastas Ignoradas (separadas por vírgula)" Foreground="#CCCCCC"/>
                            <TextBox x:Name="HarvestExcludeDirs" Style="{StaticResource ModernTextBoxStyle}" 
                                     Height="100" AcceptsReturn="True" TextWrapping="Wrap" VerticalContentAlignment="Top"/>
                        </StackPanel>
                    </Grid>

                    <Grid Margin="0,10,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <Label Content="Tamanho Máximo de Arquivo (KB)" Foreground="#CCCCCC"/>
                            <TextBox x:Name="HarvestMaxFileSizeInput" Style="{StaticResource InputStyle}"/>
                        </StackPanel>
                    </Grid>

                    <TextBlock Text="Limites Padrão" FontSize="16" Foreground="{StaticResource AccentColor}" Margin="0,20,0,10"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <Label Content="Score Mínimo (0-100)" Foreground="#CCCCCC"/>
                            <TextBox x:Name="HarvestMinScore" Style="{StaticResource InputStyle}"/>
                        </StackPanel>
                        <StackPanel Grid.Column="2">
                            <Label Content="Top Arquivos (Qtd)" Foreground="#CCCCCC"/>
                            <TextBox x:Name="HarvestTopDefault" Style="{StaticResource InputStyle}"/>
                        </StackPanel>
                    </Grid>

                    <TextBlock Text="Pesos de Relevância (IA)" FontSize="16" Foreground="{StaticResource AccentColor}" Margin="0,20,0,10"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel>
                            <Label Content="Fan-In (Dependências Entrando)" Foreground="#CCCCCC"/>
                            <TextBox x:Name="HarvestWeightFanIn" Style="{StaticResource InputStyle}"/>

                            <Label Content="Densidade de Keywords" Foreground="#CCCCCC" Margin="0,10,0,0"/>
                            <TextBox x:Name="HarvestWeightDensity" Style="{StaticResource InputStyle}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2">
                            <Label Content="Fan-Out (Dependências Saindo)" Foreground="#CCCCCC"/>
                            <TextBox x:Name="HarvestWeightFanOut" Style="{StaticResource InputStyle}"/>

                            <Label Content="Penalidade de Código Morto" Foreground="#CCCCCC" Margin="0,10,0,0"/>
                            <TextBox x:Name="HarvestWeightDeadCode" Style="{StaticResource InputStyle}"/>
                        </StackPanel>
                    </Grid>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
                        <Button Content="Salvar Alterações" Click="SaveHarvestSettings_Click" Style="{StaticResource PrimaryButtonStyle}" Width="150"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <Grid x:Name="OrganizerSettingsPanel" Visibility="Collapsed">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                <Button Content="&#xE72B;" FontFamily="Segoe MDL2 Assets" FontSize="16" 
                        Foreground="White" Background="Transparent" BorderThickness="0"
                        Click="BackToSettingsList_Click" Margin="0,0,10,0"/>
                <TextBlock Text="Configuração: Organizer" FontSize="20" FontWeight="SemiBold" Foreground="White" VerticalAlignment="Center"/>
            </StackPanel>

            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="250"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Border BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,1,0" Padding="0,0,10,0">
                    <DockPanel>
                        <Button DockPanel.Dock="Bottom" Content="+ Nova Categoria" Style="{StaticResource SecondaryButtonStyle}" 
                                Height="35" Margin="0,10,0,0" Click="AddOrganizerCategory_Click"/>
                        <ListBox x:Name="OrganizerCategoriesList" Background="Transparent" BorderThickness="0" 
                                 Foreground="White" DisplayMemberPath="Name" SelectionChanged="OrganizerCategory_SelectionChanged">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Padding" Value="10,8"/>
                                    <Setter Property="Margin" Value="0,0,0,2"/>
                                    <Setter Property="Background" Value="#2D2D30"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ListBoxItem">
                                                <Border Background="{TemplateBinding Background}" CornerRadius="4" Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter/>
                                                </Border>
                                                    <ControlTemplate.Triggers>
                                                    <Trigger Property="IsSelected" Value="True">
                                                        <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
                                                    </Trigger>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Cursor" Value="Hand"/>
                                                        <Setter Property="Background" Value="#3E3E42"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ListBox.ItemContainerStyle>
                        </ListBox>
                    </DockPanel>
                </Border>

                <ScrollViewer Grid.Column="1" Margin="20,0,0,0" VerticalScrollBarVisibility="Auto">
                    <StackPanel x:Name="OrganizerEditForm" Visibility="Collapsed">
                        <TextBlock Text="Detalhes da Categoria" FontSize="16" Foreground="{StaticResource AccentBrush}" Margin="0,0,0,10"/>

                        <Label Content="Nome da Categoria" Foreground="#CCCCCC"/>
                        <TextBox x:Name="OrgCatName" Style="{StaticResource InputStyle}"/>

                        <Label Content="Nome da Pasta Destino" Foreground="#CCCCCC" Margin="0,10,0,0"/>
                        <TextBox x:Name="OrgCatFolder" Style="{StaticResource InputStyle}"/>

                        <Label Content="Palavras-Chave (separadas por vírgula)" Foreground="#CCCCCC" Margin="0,10,0,0"/>
                        <TextBox x:Name="OrgCatKeywords" Style="{StaticResource ModernTextBoxStyle}" 
                                 Height="80" AcceptsReturn="True" TextWrapping="Wrap" VerticalContentAlignment="Top"/>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
                            <Button Content="Remover" Click="DeleteOrganizerCategory_Click" Background="Transparent" Foreground="#E81123" BorderThickness="0" Margin="0,0,10,0"/>
                            <Button Content="Salvar Alterações" Click="SaveOrganizerCategory_Click" Style="{StaticResource PrimaryButtonStyle}" Width="150"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Grid>

        <Grid x:Name="MigrationsSettingsPanel" Visibility="Collapsed">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                <Button Content="&#xE72B;" FontFamily="Segoe MDL2 Assets" FontSize="16" 
                        Foreground="White" Background="Transparent" BorderThickness="0"
                        Click="BackToSettingsList_Click" Margin="0,0,10,0"/>
                <TextBlock Text="Configuração: EF Core Migrations" FontSize="20" FontWeight="SemiBold" Foreground="White" VerticalAlignment="Center"/>
            </StackPanel>

            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="0,0,20,0" MaxWidth="600" HorizontalAlignment="Left">
                    <TextBlock Text="Caminhos do Projeto" FontSize="16" Foreground="{StaticResource AccentBrush}" Margin="0,0,0,10"/>

                    <Label Content="Caminho Raiz do Projeto (Root Path)" Foreground="#CCCCCC"/>
                    <components:PathSelector x:Name="MigRootPathSelector" IsFolderPicker="True" />

                    <Label Content="Caminho do Projeto de Startup (Startup Project)" Foreground="#CCCCCC" Margin="0,10,0,0"/>
                    <components:PathSelector x:Name="MigStartupPathSelector" IsFolderPicker="True" />

                    <TextBlock Text="Configuração do Contexto" FontSize="16" Foreground="{StaticResource AccentBrush}" Margin="0,30,0,10"/>

                    <Label Content="Nome Completo do DbContext" Foreground="#CCCCCC"/>
                    <TextBox x:Name="MigContextInput" Style="{StaticResource InputStyle}" FontFamily="Consolas"/>

                    <Label Content="Argumentos Adicionais (dotnet ef ...)" Foreground="#CCCCCC" Margin="0,10,0,0"/>
                    <TextBox x:Name="MigArgsInput" Style="{StaticResource InputStyle}" FontFamily="Consolas"/>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
                        <Button Content="Salvar Alterações" Click="SaveMigrationsSettings_Click" Style="{StaticResource PrimaryButtonStyle}" Width="150"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <Grid x:Name="NgrokSettingsPanel" Visibility="Collapsed">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                <Button Content="&#xE72B;" FontFamily="Segoe MDL2 Assets" FontSize="16" 
                        Foreground="White" Background="Transparent" BorderThickness="0"
                        Click="BackToSettingsList_Click" Margin="0,0,10,0"/>
                <TextBlock Text="Configuração: Ngrok" FontSize="20" FontWeight="SemiBold" Foreground="White" VerticalAlignment="Center"/>
            </StackPanel>

            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="0,0,20,0" MaxWidth="600" HorizontalAlignment="Left">
                    <TextBlock Text="Execução Local" FontSize="16" Foreground="{StaticResource AccentBrush}" Margin="0,0,0,10"/>

                    <Label Content="Caminho do Executável (ngrok.exe)" Foreground="#CCCCCC"/>
                    <components:PathSelector x:Name="NgrokExePathSelector" IsFolderPicker="True" />

                    <TextBlock Text="Autenticação e Argumentos" FontSize="16" Foreground="{StaticResource AccentBrush}" Margin="0,30,0,10"/>

                    <Label Content="Auth Token (Opcional - via --authtoken)" Foreground="#CCCCCC"/>
                    <TextBox x:Name="NgrokAuthTokenInput" Style="{StaticResource InputStyle}" FontFamily="Consolas"/>

                    <Label Content="Argumentos Adicionais" Foreground="#CCCCCC" Margin="0,10,0,0"/>
                    <TextBox x:Name="NgrokArgsInput" Style="{StaticResource InputStyle}" FontFamily="Consolas"/>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
                        <Button Content="Salvar Alterações" Click="SaveNgrokSettings_Click" Style="{StaticResource PrimaryButtonStyle}" Width="150"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Grid>
    </Grid>
</UserControl>
