<html><head><meta charset='UTF-8'>
<link rel='stylesheet' href='../prism-tomorrow.min.css'>
<style>
body { background: #1d1d1d; margin: 0; padding: 10px; font-size: 14px; }
pre { border-radius: 6px; }
</style>
</head><body>
<pre><code class='language-csharp'>using DevTools.Rename.Abstractions;
using DevTools.Core.Utilities;

namespace DevTools.Rename.Providers;

public sealed class DirectoryScanner
{
    private readonly IRenameFileSystem _fs;

    public DirectoryScanner(IRenameFileSystem fs)
    {
        _fs = fs;
    }

    public ScanResult Scan(string rootPath, PathFilter filter)
    {
        var files = new List&lt;string&gt;();
        var directories = new List&lt;string&gt;();

        Recurse(rootPath, rootPath, filter, files, directories);

        return new ScanResult(files, directories);
    }

    private void Recurse(
        string rootPath,
        string current,
        PathFilter filter,
        List&lt;string&gt; files,
        List&lt;string&gt; directories)
    {
        foreach (var dir in _fs.EnumerateDirectories(current, &quot;*&quot;, SearchOption.TopDirectoryOnly))
        {
            var relative = Path.GetRelativePath(rootPath, dir);
            var normalized = Normalize(relative);

            if (filter.IsExcluded(normalized))
                continue;

            directories.Add(dir);
            Recurse(rootPath, dir, filter, files, directories);
        }

        foreach (var file in _fs.EnumerateFiles(current, &quot;*&quot;, SearchOption.TopDirectoryOnly))
        {
            var relative = Path.GetRelativePath(rootPath, file);
            var normalized = Normalize(relative);

            if (filter.IsExcluded(normalized))
                continue;

            files.Add(file);
        }
    }

    private static string Normalize(string path)
        =&gt; path.Replace(&#39;\\&#39;, &#39;/&#39;);
}

public sealed record ScanResult(
    IReadOnlyList&lt;string&gt; Files,
    IReadOnlyList&lt;string&gt; Directories);
</code></pre>
<script src='../prism.min.js'></script>
<script src='../prism-csharp.min.js'></script>
<script src='../prism-json.min.js'></script>
<script src='../prism-markdown.min.js'></script>
<script src='../prism-markup.min.js'></script>
<script src='../prism-powershell.min.js'></script>
<script src='../prism-yaml.min.js'></script>

</body></html>