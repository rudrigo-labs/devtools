<html><head><meta charset='UTF-8'>
<link rel='stylesheet' href='../prism-tomorrow.min.css'>
<style>
body { background: #1d1d1d; margin: 0; padding: 10px; font-size: 14px; }
pre { border-radius: 6px; }
</style>
</head><body>
<pre><code class='language-csharp'>using System.Text.RegularExpressions;

namespace DevTools.Core.Utilities;

public sealed class GlobMatcher
{
    private readonly Regex _regex;

    public GlobMatcher(string pattern)
    {
        Pattern = pattern ?? throw new ArgumentNullException(nameof(pattern));
        _regex = new Regex(&quot;^&quot; + GlobToRegex(Normalize(pattern)) + &quot;$&quot;, RegexOptions.Compiled | RegexOptions.IgnoreCase | RegexOptions.CultureInvariant);
    }

    public string Pattern { get; }

    public bool IsMatch(string path)
    {
        if (string.IsNullOrEmpty(path))
            return false;

        return _regex.IsMatch(Normalize(path));
    }

    public static bool IsMatch(string path, string pattern)
    {
        if (string.IsNullOrWhiteSpace(pattern))
            return false;

        var regex = &quot;^&quot; + GlobToRegex(Normalize(pattern)) + &quot;$&quot;;
        return Regex.IsMatch(Normalize(path), regex, RegexOptions.IgnoreCase | RegexOptions.CultureInvariant);
    }

    private static string Normalize(string value)
        =&gt; value.Replace(Path.DirectorySeparatorChar, &#39;/&#39;)
                .Replace(Path.AltDirectorySeparatorChar, &#39;/&#39;);

    private static string GlobToRegex(string glob)
    {
        var sb = new System.Text.StringBuilder();
        for (int i = 0; i &lt; glob.Length; i++)
        {
            var c = glob[i];
            if (c == &#39;*&#39;)
            {
                var isDoubleStar = i + 1 &lt; glob.Length &amp;&amp; glob[i + 1] == &#39;*&#39;;
                if (isDoubleStar)
                {
                    sb.Append(&quot;.*&quot;);
                    i++;
                }
                else
                {
                    sb.Append(&quot;[^/]*&quot;);
                }
            }
            else if (c == &#39;?&#39;)
            {
                sb.Append(&quot;[^/]&quot;);
            }
            else
            {
                sb.Append(Regex.Escape(c.ToString()));
            }
        }
        return sb.ToString();
    }
}
</code></pre>
<script src='../prism.min.js'></script>
<script src='../prism-csharp.min.js'></script>
<script src='../prism-json.min.js'></script>
<script src='../prism-markdown.min.js'></script>
<script src='../prism-markup.min.js'></script>
<script src='../prism-powershell.min.js'></script>
<script src='../prism-yaml.min.js'></script>

</body></html>