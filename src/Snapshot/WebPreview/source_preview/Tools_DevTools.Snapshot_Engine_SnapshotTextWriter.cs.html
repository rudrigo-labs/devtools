<html><head><meta charset='UTF-8'>
<link rel='stylesheet' href='../prism-tomorrow.min.css'>
<style>
body { background: #1d1d1d; margin: 0; padding: 10px; font-size: 14px; }
pre { border-radius: 6px; }
</style>
</head><body>
<pre><code class='language-csharp'>using System.Text;

namespace DevTools.Snapshot.Engine;

internal sealed class SnapshotTextWriter
{
    public async Task WriteAsync(string rootPath, string outFile, IReadOnlySet&lt;string&gt; ignoreDirs)
    {
        if (string.IsNullOrWhiteSpace(rootPath))
            throw new ArgumentException(&quot;rootPath is required.&quot;, nameof(rootPath));

        if (!Directory.Exists(rootPath))
            throw new DirectoryNotFoundException($&quot;RootPath not found: {rootPath}&quot;);

        var sb = new StringBuilder();
        var root = new DirectoryInfo(rootPath);

        sb.AppendLine($&quot;Snapshot: {DateTimeOffset.UtcNow:O}&quot;);
        sb.AppendLine($&quot;Project: {root.Name}&quot;);
        sb.AppendLine(new string(&#39;-&#39;, 44));
        sb.AppendLine(root.Name);

        void Walk(string path, string prefix)
        {
            var entries = new DirectoryInfo(path).GetFileSystemInfos()
                .Where(e =&gt; !ignoreDirs.Contains(e.Name))
                .OrderBy(e =&gt; e is FileInfo ? 1 : 0)
                .ThenBy(e =&gt; e.Name, StringComparer.OrdinalIgnoreCase)
                .ToList();

            for (int i = 0; i &lt; entries.Count; i++)
            {
                var isLast = i == entries.Count - 1;
                sb.AppendLine($&quot;{prefix}{(isLast ? &quot;└── &quot; : &quot;├── &quot;)}{entries[i].Name}&quot;);

                if (entries[i] is DirectoryInfo dir)
                    Walk(dir.FullName, prefix + (isLast ? &quot;    &quot; : &quot;│   &quot;));
            }
        }

        Walk(rootPath, &quot;&quot;);

        Directory.CreateDirectory(Path.GetDirectoryName(outFile)!);
        await File.WriteAllTextAsync(outFile, sb.ToString(), new UTF8Encoding(false));
    }
}
</code></pre>
<script src='../prism.min.js'></script>
<script src='../prism-csharp.min.js'></script>
<script src='../prism-json.min.js'></script>
<script src='../prism-markdown.min.js'></script>
<script src='../prism-markup.min.js'></script>
<script src='../prism-powershell.min.js'></script>
<script src='../prism-yaml.min.js'></script>

</body></html>