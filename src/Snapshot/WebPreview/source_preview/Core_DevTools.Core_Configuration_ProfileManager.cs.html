<html><head><meta charset='UTF-8'>
<link rel='stylesheet' href='../prism-tomorrow.min.css'>
<style>
body { background: #1d1d1d; margin: 0; padding: 10px; font-size: 14px; }
pre { border-radius: 6px; }
</style>
</head><body>
<pre><code class='language-csharp'>using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text.Json;
using DevTools.Core.Models;

namespace DevTools.Core.Configuration;

public class ProfileManager
{
    private readonly string _basePath;

    public ProfileManager()
    {
        var appData = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
        _basePath = Path.Combine(appData, &quot;DevTools&quot;, &quot;profiles&quot;);
        
        if (!Directory.Exists(_basePath))
        {
            Directory.CreateDirectory(_basePath);
        }
    }

    private string GetFilePath(string toolName)
    {
        // Sanitize tool name just in case
        var safeName = string.Join(&quot;_&quot;, toolName.Split(Path.GetInvalidFileNameChars()));
        return Path.Combine(_basePath, $&quot;devtools.{safeName.ToLowerInvariant()}.json&quot;);
    }

    public List&lt;ToolProfile&gt; LoadProfiles(string toolName)
    {
        var path = GetFilePath(toolName);
        if (!File.Exists(path))
            return new List&lt;ToolProfile&gt;();

        try
        {
            var json = File.ReadAllText(path);
            var container = JsonSerializer.Deserialize&lt;ToolProfileContainer&gt;(json, new JsonSerializerOptions { PropertyNameCaseInsensitive = true });
            return container?.Profiles ?? new List&lt;ToolProfile&gt;();
        }
        catch
        {
            // Fail safe: return empty if file is corrupted
            return new List&lt;ToolProfile&gt;();
        }
    }

    public void SaveProfile(string toolName, ToolProfile profile)
    {
        var profiles = LoadProfiles(toolName);
        var existing = profiles.FirstOrDefault(p =&gt; p.Name.Equals(profile.Name, StringComparison.OrdinalIgnoreCase));
        
        if (existing != null)
        {
            profiles.Remove(existing);
        }
        
        // Update timestamp
        profile.UpdatedUtc = DateTime.UtcNow;
        profiles.Add(profile);
        
        SaveProfilesInternal(toolName, profiles);
    }
    
    public void DeleteProfile(string toolName, string profileName)
    {
        var profiles = LoadProfiles(toolName);
        var existing = profiles.FirstOrDefault(p =&gt; p.Name.Equals(profileName, StringComparison.OrdinalIgnoreCase));
        
        if (existing != null)
        {
            profiles.Remove(existing);
            SaveProfilesInternal(toolName, profiles);
        }
    }
    
    public ToolProfile? GetProfile(string toolName, string profileName)
    {
        var profiles = LoadProfiles(toolName);
        return profiles.FirstOrDefault(p =&gt; p.Name.Equals(profileName, StringComparison.OrdinalIgnoreCase));
    }

    private void SaveProfilesInternal(string toolName, List&lt;ToolProfile&gt; profiles)
    {
        var path = GetFilePath(toolName);
        var container = new ToolProfileContainer { Profiles = profiles };
        var json = JsonSerializer.Serialize(container, new JsonSerializerOptions { WriteIndented = true });
        File.WriteAllText(path, json);
    }
}
</code></pre>
<script src='../prism.min.js'></script>
<script src='../prism-csharp.min.js'></script>
<script src='../prism-json.min.js'></script>
<script src='../prism-markdown.min.js'></script>
<script src='../prism-markup.min.js'></script>
<script src='../prism-powershell.min.js'></script>
<script src='../prism-yaml.min.js'></script>

</body></html>